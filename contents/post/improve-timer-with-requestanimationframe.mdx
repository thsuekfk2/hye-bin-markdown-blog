---
title: "requestAnimationFrameìœ¼ë¡œ íƒ€ì´ë¨¸ ê°œì„ "
slug: "improve-timer-with-requestanimationframe"
date: "2023-11-04T00:00:00.000+00:00"
description: "ë‚´ê°€ í•˜ê³ ìˆëŠ” í”„ë¡œì íŠ¸ëŠ” íƒ€ì´ë¨¸ê°€ êµ‰ì¥íˆ ì¤‘ìš”í•˜ë‹¤..! 0ì´ˆë¼ëŠ” íƒ€ì´ë°ì— ë§ì€ ë¡œì§ê³¼ api ì „ì†¡ì´ ì´ë¤„ì§€ëŠ”ë° íƒ€ì´ë¨¸ê°€ ëŠë ¤ì§€ëŠ” ì´ìŠˆê°€ ìˆì—ˆë‹¤. ê·¼ë° ì´í•´ê°€ ì•ˆê°€ëŠ” ê²ƒì€ íƒ€ì´ë¨¸ëŠ” ë²„ë²…ê±°ë¦¬ëŠ”ë° ì™œ CSS animationì€ ì •ë§ ì˜ ì›€ì§ì´ëŠ” ê±¸ê¹Œ?"
thumbnail: "https://www.hyebin.me/post/improve-timer-with-requestanimationframe/cover.png"
tags: []
---

ë‚´ê°€ í•˜ê³ ìˆëŠ” í”„ë¡œì íŠ¸ëŠ” íƒ€ì´ë¨¸ê°€ êµ‰ì¥íˆ ì¤‘ìš”í•˜ë‹¤..! 0ì´ˆë¼ëŠ” íƒ€ì´ë°ì— ë§ì€ ë¡œì§ê³¼ api ì „ì†¡ì´ ì´ë¤„ì§€ëŠ”ë° íƒ€ì´ë¨¸ê°€ ëŠë ¤ì§€ëŠ” ì´ìŠˆê°€ ìˆì—ˆë‹¤. ğŸ¤” ê·¼ë° ì´í•´ê°€ ì•ˆê°€ëŠ” ê²ƒì€ íƒ€ì´ë¨¸ëŠ” ë²„ë²…ê±°ë¦¬ëŠ”ë° ì™œ CSS animationì€ ì •ë§ ì˜ ì›€ì§ì´ëŠ” ê±¸ê¹Œ? .. why..

ê·¸ë˜ì„œ ê¸°ì¡´ íƒ€ì´ë¨¸ì˜ ë¬¸ì œì ì„ ê³µë¶€í•˜ë©´ì„œ íƒ€ì´ë¨¸ ì½”ì–´ ë¡œì§ì„ ë‹¤ ë°”ê¿”ë²„ë ¸ë‹¤. ğŸš€

## ìë°”ìŠ¤í¬ë¦½íŠ¸ ë™ì‘ì›ë¦¬ (Stack, Queue, event loop)

![image](https://github.com/thsuekfk2/hye-bin-markdown-blog/assets/76821963/0ec10745-f811-4b37-9d2d-8fe70b7e3aa9)

ì¼ë‹¨ setInterval()Â ê³¼ setTimeout()ê°€ ëŠë ¤ì§€ëŠ” ì´ìœ ë¥¼ ì•Œê¸° ìœ„í•´ì„œëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë™ì‘ì›ë¦¬ë¥¼ ì•Œì•„ì•¼í•œë‹¤.

ì›¹ ë¸Œë¼ìš°ì € ë‚´ë¶€ì—ëŠ” ìŠ¤íƒì´ë¼ëŠ” ê³µê°„ì´ ìˆë‹¤. ìš°ë¦¬ê°€ ì‘ì„±í•œ ì½”ë“œ í•œì¤„í•œì¤„ ì´ ìš” ìŠ¤íƒì— ë“¤ì–´ê°€ê³  ì½”ë“œë¥¼ ì‹¤í–‰ì‹œì¼œ ì£¼ëŠ” ê³³ì´ë‹¤. ê·¸ë¦¬ê³  ê·¸ ì˜†ì— í™ì´ë¼ëŠ” ê³µê°„ì´ ìˆëŠ”ë° ì—¬ê¸°ì„  ë³€ìˆ˜ê°€ ì €ì¥ë˜ì–´ ìˆë‹¤.

ìŠ¤íƒì€ í•˜ë‚˜ë°–ì— ì—†ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ìŠ¤ë ˆë“œì–¸ì–´(== í•œë²ˆì— ì½”ë“œ í•œì¤„ ë°–ì— ì‹¤í–‰ ëª»í•¨) ë¼ê³  í•˜ëŠ”ê²ƒì´ë‹¤ !

í•˜ì§€ë§Œ setTimeoutë‚˜ ajax ìš”ì²­ ,ì´ë²¤íŠ¸ ë¦¬ìŠ¤í„° ê°™ì€ ì½”ë“œëŠ” ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ ëŒ€ê¸°ì‹¤(Web API)ì— ì ê¹ ìˆë‹¤ê°€ íë¼ëŠ” ëŒ€ê¸°ì‹¤ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤. ê·¸ë¦¬ê³  ì²˜ë¦¬ê°€ ì™„ë£Œëœ ì½”ë“œë“¤ì´ ìŠ¤íƒìœ¼ë¡œ í•˜ë‚˜ì”© ì˜¬ë ¤ë³´ë‚¸ë‹¤.

ì´ë ‡ê²Œ ëŒ€ê¸°ì‹¤ì„ ê±°ì¹˜ëŠ” ì´ìœ ëŠ” ìŠ¤íƒì€ ë°”ìœ ê³µê°„ì´ê¸° ë•Œë¬¸ì´ë‹¤. ìŠ¤íƒì´ ë¬´ì‘ì • ë°”ì˜ê²Œ ë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê³ , ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•  ë•Œ ì›í™œí•œ ë™ì‘ì„ ë³´ì¥í•œë‹¤. í•˜ì§€ë§Œ ì¡°ê±´ì´ ìˆë‹¤. ìŠ¤íƒì´ í…… ë¹„ì—ˆì„ ë•Œë§Œ íì— ì˜¬ë ¤ ë³´ë‚¸ë‹¤.

ë”°ë¼ì„œ ìŠ¤íƒê³¼ íë¥¼ ë„ˆë¬´ ë°”ì˜ê²Œ ë§Œë“¤ë©´ ì•ˆëœë‹¤! ë¸Œë¼ìš°ì €ê°€ ëŠë¦¬ê±°ë‚˜ ë²„ë²…ì´ëŠ” í˜„ìƒì´ ë‚˜íƒ€ë‚˜ê²Œ ëœë‹¤.

## setInterval()Â ì™€Â setTimeout()ì€ ì‹œê°„ì„ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.

ë‚˜ëŠ” setIntervalë¡œ 1ì´ˆë§ˆë‹¤ íƒ€ì´ë¨¸ë¥¼ ì‹¤í–‰ì‹œì¼°ë‹¤. ê·¸ëŸ¼ 1ì´ˆë§ˆë‹¤ í•¨ìˆ˜ ë˜ëŠ” ì½”ë“œ ë¸”ë¡ì´ íì— ì¶”ê°€ë˜ê³  ìŠ¤íƒì´ ë¹„ì–´ ìˆì„ ë•Œ ì‹¤í–‰ë˜ë©´ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ì‘ì—…ì´ ë°˜ë³µ ì‹¤í–‰ë˜ê²Œ ëœë‹¤.

ì´ë•Œ, ì´ì „ ì‹¤í–‰ì´ ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì•„ ìŠ¤íƒ(Stack)ì´ ë¹„ì–´ ìˆì§€ ì•Šë‹¤ë©´, ë‹¤ìŒ ì‹¤í–‰ì€ í(Queue)ì— ì¶”ê°€ë˜ì§€ë§Œ ìŠ¤íƒì´ ë¹„ì–´ì§ˆ ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ê²Œ ëœë‹¤. ì´ë•Œ íƒ€ì´ë¨¸ê°€ ëŠë ¤ì§€ê²Œ ë˜ëŠ”ê²ƒ!

## setInterval()Â ì™€Â setTimeout()ì€ í”„ë ˆì„ì„ ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤.

ìš°ë¦¬ê°€ ì˜í™”ë‚˜ ì• ë‹ˆë©”ì´ì…˜ì„ ë³´ëŠ” ê²ƒì€ ì‚¬ì‹¤ ì§§ì€ ì‹œê°„ ê°„ê²©ì— ì´ì–´ì§€ëŠ” ì¥ë©´ì„ ë³´ëŠ” ê²ƒì´ë‹¤. ì´ë•Œ **ê°ê°ì˜ ì¥ë©´ì„ frame**ì´ë¼ê³  í•œë‹¤. setInterval()Â ì™€Â setTimeout()Â ì˜ ë¬¸ì œì ì€ ì£¼ì–´ì§„ ì‹œê°„ë‚´ì— ë™ì‘ì„ í•  ë¿Â í”„ë ˆì„ì„ ì‹ ê²½ ì“°ì§€ ì•Šê³  ë™ì‘í•œë‹¤.

ë¸Œë¼ìš°ì €ê°€ ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰ìœ¼ë¡œ ì¸í•´ ì§€ì—°ë˜ì–´ë²„ë¦¬ë©´ ë¸Œë¼ìš°ì € ë Œë”ë§ ë‹¨ê³„ì¸ ë ˆì´ì•„ì›ƒ - í˜ì¸íŠ¸ - í•©ì„± ê³¼ì •ì´ ë‹¤ì‹œ ì¼ì–´ë‚˜ê²Œ ëœë‹¤. ì´ë¡œ ì¸í•´ í”„ë ˆì„ì´ ì§€ì—°ë˜ë‚˜ì„œ ìƒì„±ë˜ì§€ ëª»í•˜ê³  ëˆ„ë½ë˜ì–´ ë²„ë ¤ 1 í”„ë ˆì„ì”© ê¹ì´ëŠ” í˜„ìƒì´ ë‚˜íƒ€ë‚˜ê²Œ ëœë‹¤.

í”„ë ˆì„ì´ ë¹ ë¥´ê²Œ ìƒì„±ë˜ì–´ì•¼ ì›¹ í˜ì´ì§€ê°€ ë¶€ë“œëŸ½ê²Œ ë³´ì´ëŠ”ë° í”„ë ˆì„ì´ ê¹ì—¬ ê²°êµ­ í™”ë©´ì´ ë²„ë²…ì´ê²Œ ëœë‹¤. ì´ëŸ¬í•œ í˜„ìƒì´ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ì½œ ìŠ¤íƒ(call stack)ì€ ì‹±ê¸€ ìŠ¤ë ˆë“œ ì´ê¸° ë•Œë¬¸ì´ë‹¤

ì´ëŸ¬í•œ ì§€ì—°(delay) ë°œìƒ ë¬¸ì œ ë•Œë¬¸ì— ëŒ€ì•ˆìœ¼ë¡œ íƒ„ìƒí•œ ê²ƒì´ ë°”ë¡œ rAF(requestAnimationFrame) ì´ë‹¤.

## requestAnimationFrame

requestAnimationFrame í•¨ìˆ˜ëŠ” setInterval() í•¨ìˆ˜ì—ì„œ ì–¸ì œ í˜¸ì¶œí• ì§€ ì„¤ì •í•˜ëŠ” ê²ƒê³¼ëŠ” ë‹¬ë¦¬ ë¸Œë¼ìš°ì €ì—ì„œ ì‹œìŠ¤í…œì´ í”„ë ˆì„ì„ ê·¸ë¦´ ì¤€ë¹„ê°€ ë˜ë©´ ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ì„ í˜¸ì¶œí•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ ì›¹í˜ì´ì§€ë¥¼ ë³´ë‹¤ ì›í™œí•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

ì‹¤ì œ í™”ë©´ì´ ê°±ì‹ ë˜ì–´ í‘œì‹œë˜ëŠ” ì£¼ê¸°ì— ë”°ë¼ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì£¼ê¸° ë•Œë¬¸ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€Â **í”„ë ˆì„ ì‹œì‘ ì‹œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥**í•´ì£¼ì–´ ìœ„ì™€ ê°™ì€ ë°€ë¦¼ í˜„ìƒì„ ë°©ì§€í•´ì¤€ë‹¤.

requestAnimationFrameì€ ë¸Œë¼ìš°ì €ì˜ ë Œë”ë§ ì£¼ê¸°ì— ë§ì¶° ì½”ë“œë¥¼ ì‹¤í–‰ëœë‹¤. ë¸Œë¼ìš°ì €ê°€ ë‹¤ìŒ í”„ë ˆì„ì„ ê·¸ë¦¬ê¸° ì „ì— ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡ ì˜ˆì•½í•˜ê¸° ë•Œë¬¸ì—Â ê° í”„ë ˆì„ì´ ì •í™•íˆ 16.6ms ê°„ê²©ìœ¼ë¡œ ë Œë”ë§ë˜ê²Œ ë˜ê²Œ ëœë‹¤. ì´ë¡œì¸í•´ ê° í”„ë ˆì„ì€ ë¸Œë¼ìš°ì €ì˜ í”„ë ˆì„ ì£¼ê¸°ì— ì •í™•í•˜ê²Œ ë§ê²Œ ëœë‹¤.

setIntervalì—ì„œëŠ” ì¤€ë¹„ê°€ ë˜ì§€ ì•Šì•„ë„ í˜ì¸íŒ…ì„ ìš”ì²­í•˜ëŠ” ê²ƒê³¼ ëŒ€ë¹„ë˜ë©´ì„œ, ë³´ë‹¤ ì›¹ë¸Œë¼ìš°ì €ì— ìµœì í™” ë˜ì–´ ìˆë‹¤ê³  ë§í•  ìˆ˜ ìˆë‹¤.

## requestAnimationFrameì„ í™œìš©í•œ íƒ€ì´ë¨¸ ì½”ë“œ ì‘ì„±í•˜ê¸°

```javascript
const timerIdRef = useRef();
const [countdownSeconds, setCountdownSeconds] = useState();

//íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
const updateTimer = (startTime, time) => {
  const elapsedTime = Date.now() - startTime;
  const remainingSeconds = Math.max(time - Math.floor(elapsedTime / 1000), 0);
  setCountdownSeconds(remainingSeconds);
  if (remainingSeconds > 0) {
    timerIdRef.current = requestAnimationFrame(() =>
      updateTimer(startTime, time),
    );
  }
};

//íƒ€ì´ë¨¸ ì‹œì‘ í•¨ìˆ˜
const startTimer = () => {
  if (timerIdRef.current) {
    cancelAnimationFrame(timerIdRef.current);
  }
  const startTime = Date.now();
  updateTimer(startTime, countdownSeconds);
};

//íƒ€ì´ë¨¸ ì •ì§€ í•¨ìˆ˜
const stopTimer = () => {
  cancelAnimationFrame(timerIdRef.current);
};

//íƒ€ì´ë¨¸ ë¦¬ì…‹ í•¨ìˆ˜
const resetTimer = (time) => {
  if (timerIdRef.current) {
    cancelAnimationFrame(timerIdRef.current);
  }
  const startTime = Date.now();
  updateTimer(startTime, time);
};
```

requestAnimationFrameë¡œ íƒ€ì´ë¨¸ê°€ ëŠë ¤ì§€ëŠ” ì´ìŠˆë¥¼ í•´ê²° í•  ìˆ˜ ìˆì—ˆë‹¤ ğŸ˜ƒ

## reference

[https://inpa.tistory.com/entry/ğŸŒ-requestAnimationFrame-ê°€ì´ë“œ#íƒ€ì´ë¨¸*í•¨ìˆ˜ì˜*ë¬¸ì œì ](https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C#%ED%83%80%EC%9D%B4%EB%A8%B8_%ED%95%A8%EC%88%98%EC%9D%98_%EB%AC%B8%EC%A0%9C%EC%A0%90)

[https://junheedot.tistory.com/entry/ì´ë²¤íŠ¸-ë£¨í”„-ë™ì‘-ì›ë¦¬](https://junheedot.tistory.com/entry/%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC)