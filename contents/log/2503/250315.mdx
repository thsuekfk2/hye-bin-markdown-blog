---
title: "로컬 환경에서 쿠키가 저장되지 않는 문제 해결하기 (1)"
date: 2025-03-15
thumbnail: "/log/2503/1.webp"
description: "중복 로그인 처리를 막기 위해 세션 기반 인증을 적용하기로 했습니다. 단순히 쿠키에 세션 정보를 저장하면 될 거라 생각했지만 개발 환경(로컬 호스트)에서 쿠키가 저장되지 않는 문제가 발생했습니다. 이번 포스팅에서는 인증 방식 흐름을 다시 정리하고, 왜 로컬에서 쿠키가 저장되지 않는지, 그리고 어떻게 해결할 수 있는지 살펴보겠습니다. 아직 완벽하게 해결은 못해서 추후 업데이트할 예정이에요 "
---

중복 로그인 처리를 막기 위해 세션 기반 인증을 적용하기로 했습니다.

단순히 쿠키에 세션 정보를 저장하면 될 거라 생각했지만 개발 환경(로컬 호스트)에서 쿠키가 저장되지 않는 문제가 발생했습니다. 이번 포스팅에서는 인증 방식 흐름을 다시 정리하고, 왜 로컬에서 쿠키가 저장되지 않는지, 그리고 어떻게 해결할 수 있는지 살펴보겠습니다. 아직 완벽하게 해결은 못해서 추후 업데이트할 예정이에요 🥲

## 쿠키란? 🍪

쿠키는 웹 브라우저가 특정 웹사이트의 정보를 저장하는 작은 데이터 조각입니다. 주로 사용자의 세션 정보, 로그인 상태, 설정 값 등을 유지하는 데 사용됩니다.

### 쿠키의 특징

- 클라이언트(브라우저)에 저장됨
- **같은 도메인**에서 요청할 때 브라우저가 자동으로 서버에 전송됨
- 만료 날짜 설정 가능 (Expires, Max-Age)
- 특정 도메인 및 경로에서만 사용 가능 (Domain, Path)
- Secure, HttpOnly, SameSite 옵션을 설정하여 **보안 강화 가능**

### 쿠키의 동작 흐름

1. 사용자가 웹사이트에 접속
2. 서버가 Set-Cookie 헤더를 포함해 응답
3. 브라우저가 쿠키 저장
4. 브라우저는 이후 같은 도메인으로 요청할 때, 쿠키를 자동으로 요청 헤더에 포함하여 서버에 전송
5. 서버는 해당 쿠키를 확인하고, 로그인 상태를 유지할 수 있도록 인증을 처리
6. 쿠키가 만료되거나 삭제되면 더 이상 전송되지 않음

### 쿠키 옵션

쿠키는 자동으로 전달되는 특징 때문에 보안에 취약하기 때문에 적절한 옵션을 설정해야합니다.

| **옵션**                  | **역할**                                   |
| ------------------------- | ------------------------------------------ |
| **Expires** / **Max-Age** | 쿠키 만료 시간 지정                        |
| **Domain**                | 쿠키가 적용될 도메인 지정                  |
| **Path**                  | 쿠키가 적용될 경로 지정                    |
| **Secure**                | HTTPS에서만 전송되도록 설정                |
| **HttpOnly**              | JavaScript에서 접근 불가능 (보안 강화)     |
| **SameSite**              | 크로스 사이트 요청에서 쿠키 전송 여부 설정 |

## **세션이란? 🔐**

세션은 웹 애플리케이션에서 **사용자의 상태를 유지**하기 위한 방식입니다.

주로 **로그인 상태 유지, 장바구니 기능, 사용자 맞춤 설정** 등을 위해 사용됩니다.

### 세션의 동작 흐름

세션은 보통 서버에서 관리되며, 사용자는 세션 ID를 통해 세션을 식별합니다. 세션 ID가 유효하면 로그인 상태 유지, 유효하지 않으면 로그아웃 처리됩니다.

1. 사용자가 서버에 요청 (예: 로그인 요청)
2. 서버가 세션 생성 및 저장 (사용자 정보, 로그인 상태 등)
3. 서버가 클라이언트에 세션 ID 전달 (보통 쿠키에 저장됨)
4. 클라이언트가 이후 요청 시 세션 ID를 포함하여 전송
5. 서버가 세션 ID를 확인하고 해당 세션 정보를 가져옴
6. 응답을 클라이언트에게 반환

## 세션과 쿠키 총 정리!

1. 서버가 Set-Cookie 헤더를 통해 브라우저에게 쿠키를 전달
2. 브라우저는 받은 쿠키를 저장
3. 이후 브라우저가 해당 쿠키의 도메인과 일치하는 요청을 보낼 때, 자동으로 쿠키를 요청 헤더에 포함하여 서버로 전송
4. 세션은 서버에서 관리되지만, 사용자의 로그인 상태를 유지하려면 클라이언트(브라우저)가 세션을 식별할 방법이 필요
5. 이를 위해, 서버는 세션 ID를 쿠키에 저장하고, 브라우저는 이를 요청 시 자동으로 서버에 전달
6. 결과적으로, 쿠키를 활용해 사용자의 세션을 유지할 수 있음!

## 문제 상황 파악 ✨

- 운영 환경에서는 쿠키가 정상적으로 저장되고 세션이 유지되지만 개발 환경(localhost)에서는 쿠키가 저장되지 않음
- 로그인을 하면 응답 헤더에 Set-Cookie가 포함되어 있지만, 브라우저의 개발자 도구에서 확인해 보면 저장되지 않음
- 페이지를 새로고침하면 로그인 상태가 유지되지 않음

## 예상되는 문제 원인 ✨

### 1. Secure 옵션 문제

Secure 옵션이 설정된 쿠키는 HTTPS 환경에서만 동작합니다. 운영 서버는 HTTPS를 사용하지만, 로컬 개발 환경은 기본적으로 HTTP이므로 쿠키가 저장되지 않습니다

### 2. SameSite 옵션 문제

| SameSite 옵션 | 설명                                                                      |
| ------------- | ------------------------------------------------------------------------- |
| **Strict**    | 같은 도메인에서만 쿠키가 전송됨 (백엔드, 프론트엔드 도메인이 동일해야 함) |
| **Lax**       | GET 요청에서는 쿠키가 전송되지만, POST 요청에서는 차단됨                  |
| **None**      | 모든 요청에서 쿠키가 전송되지만, Secure=true 필수                         |

🚨 SameSite=None을 설정하면 Secure=true가 필수이므로, HTTPS 환경이 아닌 로컬에서는 쿠키가 저장되지 않음

## **해결 방법** ✨

### 1. 개발 환경에서는 Secure 옵션을 제거하기

운영 환경에서는 Secure=true를 유지해야 하지만, 로컬 개발 환경에서는 Secure=false로 설정하면 쿠키 저장 가능합니다.

하지만 SameSite=None을 사용하면 Secure=true가 필수이기 때문에, 로컬 환경에서는 적용할 수 없음 🥲

### 2. 로컬에서 HTTPS 환경 만들기

로컬에서도 HTTPS를 적용하면 Secure=true 옵션을 유지하면서 쿠키를 저장할 수 있습니다.

1. localhost가 아닌 https://127.0.0.1을 사용
2. mkcert를 사용해 로컬 개발용 HTTPS 인증서 생성

# 마치며

이번 문제를 해결하면서 쿠키와 세션, 그리고 CORS 정책에 대해 다시 한 번 정리할 수 있었습니다. 특히 SameSite와 Secure 설정이 개발 환경과 운영 환경에서 다르게 동작할 수 있다는 점이 중요하다는 걸 깨달았습니다.

다음 포스팅에서는 로컬에서 HTTPS 설정하는 방법을 정리해볼 예정입니다! 🚀
